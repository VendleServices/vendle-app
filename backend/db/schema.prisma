generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider  = "postgresql"
  url       = env("DATABASE_URL")
  directUrl = env("DIRECT_URL")
}

enum ProjectStatus {
  DRAFT
  AUCTION_OPEN
  AUCTION_CLOSED
  IOI
  LOI
  ACTIVE
  COMPLETED
  REVIEWED
}

enum NegotiationPhase {
  IOI
  LOI
}

enum NegotiationStatus {
  pending
  accepted
  declined
}

enum MilestoneStatus {
  pending
  submitted
  approved
  paid
}

enum ScheduleEventKind {
  site_visit
  ioi_deadline
  loi_deadline
  milestone_deadline
}

model User {
  id             String        @id @default(uuid())
  email          String        @unique
  femaForms      Fema[]
  claim          Claim[]
  auction        Auction[]
  restoration    Restoration[]
  bids           Bid[]
  userType       String?
  companyName    String?
  phoneNumber    String?
  companyWebsite String?
  createdAt      DateTime      @default(now())
  updatedAt      DateTime      @default(now()) @updatedAt
  ndas           Nda[]
}

model Fema {
  id                 String   @id @default(uuid())
  firstName          String
  lastName           String
  email              String
  phone              String
  address            String
  city               String
  state              String
  zipCode            String
  propertyDamage     String
  isPrimaryResidence Boolean
  hasInsurance       Boolean
  isUsCitizen        Boolean
  createdAt          DateTime @default(now())
  updatedAt          DateTime @default(now()) @updatedAt
  user               User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  userId             String
}

model Claim {
  id                     String     @id @default(uuid())
  street                 String
  city                   String
  state                  String
  zipCode                String
  projectType            String
  designPlan             String
  needsAdjuster          Boolean
  damageTypes            String
  hasFunctionalUtilities Boolean
  hasDumpster            Boolean
  isOccupied             Boolean
  phase1Start            String
  phase1End              String
  phase2Start            String
  phase2End              String
  createdAt              DateTime   @default(now())
  updatedAt              DateTime   @default(now()) @updatedAt
  user                   User       @relation(fields: [userId], references: [id], onDelete: Cascade)
  userId                 String
  auctions               Auction[]
  images                 Image[]
  pdfs                   ClaimPdf[]
}

model Image {
  id           String @id @default(uuid())
  supabase_url String
  claim        Claim  @relation(fields: [claimId], references: [id], onDelete: Cascade)
  claimId      String
}

model ClaimPdf {
  id           String @id @default(uuid())
  supabase_url String
  claim        Claim  @relation(fields: [claimId], references: [id], onDelete: Cascade)
  claimId      String
}

model Bid {
  id                    String   @id @default(uuid())
  amount                Float
  budgetTotal           Float
  bidPdfPath            String
  subContractorExpenses Float
  overhead              Float
  laborCosts            Float
  allowance             Float
  profit                Float
  user                  User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  userId                String
  auction               Auction  @relation(fields: [auctionId], references: [id], onDelete: Cascade)
  auctionId             String
  createdAt             DateTime @default(now())
  updatedAt             DateTime @default(now()) @updatedAt
}

model Auction {
  id                    String   @id @default(uuid())
  claimId               String
  title                 String
  description           String?
  startingBid           Float
  currentBid            Float?
  status                String   @default("NDA Required")
  auctionEndDate        DateTime
  totalJobValue         Float?
  overheadAndProfit     Float?
  costBasis             String?
  materials             Float?
  salesTaxes            Float?
  depreciation          Float?
  reconstructionType    String?
  needs3rdPartyAdjuster Boolean  @default(false)
  hasDeductibleFunds    Boolean  @default(false)
  fundingSource         String?
  insuranceEstimatePdf  String?
  createdAt             DateTime @default(now())
  updatedAt             DateTime @default(now()) @updatedAt
  user                  User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  userId                String
  claim                 Claim    @relation(fields: [claimId], references: [id], onDelete: Cascade)
  bids                  Bid[]
  aiSummary             String?
  ndas                  Nda[]
}

model Restoration {
  id                        String   @id @default(uuid())
  insuranceEstimateFilePath String
  needsAdjuster             Boolean
  createdAt                 DateTime @default(now())
  updatedAt                 DateTime @default(now()) @updatedAt
  user                      User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  userId                    String
  isRcv                     Boolean
  overheadProfit            Boolean
  materials                 Boolean
  salesTaxes                Boolean
  depreciation              Boolean
}

model Nda {
  id        String  @id @default(uuid())
  userId    String
  user      User    @relation(fields: [userId], references: [id], onDelete: Cascade)
  auctionId String
  auction   Auction @relation(fields: [auctionId], references: [id], onDelete: Cascade)
  accepted  Boolean @default(false)
}
