generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider  = "postgresql"
  url       = env("DATABASE_URL")
  directUrl = env("DIRECT_URL")
}

enum ProjectStatus {
  DRAFT
  AUCTION_OPEN
  AUCTION_CLOSED
  IOI
  LOI
  ACTIVE
  COMPLETED
  REVIEWED
}

enum NegotiationPhase {
  IOI
  LOI
}

enum NegotiationStatus {
  pending
  accepted
  declined
}

enum MilestoneStatus {
  pending
  submitted
  approved
  paid
}

enum ScheduleEventKind {
  site_visit
  ioi_deadline
  loi_deadline
  milestone_deadline
}

model User {
  id             String   @id @default(uuid())
  email          String   @unique
  femaForms      Fema[]
  claim          Claim[]
  bids           Bid[]
  userType       String?
  companyName    String?
  phoneNumber    String?
  companyWebsite String?
  createdAt      DateTime @default(now())
  updatedAt      DateTime @default(now()) @updatedAt
  ndas           Nda[]
}

model Fema {
  id                 String   @id @default(uuid())
  firstName          String
  lastName           String
  email              String
  phone              String
  address            String
  city               String
  state              String
  zipCode            String
  propertyDamage     String
  isPrimaryResidence Boolean
  hasInsurance       Boolean
  isUsCitizen        Boolean
  createdAt          DateTime @default(now())
  updatedAt          DateTime @default(now()) @updatedAt
  user               User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  userId             String
}

model Claim {
  id                     String     @id @default(uuid())
  street                 String
  city                   String
  state                  String
  zipCode                String
  projectType            String
  designPlan             String
  needsAdjuster          Boolean
  damageTypes            String
  hasFunctionalUtilities Boolean
  hasDumpster            Boolean
  isOccupied             Boolean
  phase1Start            String
  phase1End              String
  phase2Start            String
  phase2End              String
  totalJobValue          Float?
  overheadAndProfit      Float?
  costBasis              String?
  materials              Float?
  salesTaxes             Float?
  depreciation           Float?
  reconstructionType     String?
  hasDeductibleFunds     Boolean    @default(false)
  fundingSource          String?
  additionalNotes        String?
  aiSummary              String?
  status                 String?    @default("Pending")
  createdAt              DateTime   @default(now())
  updatedAt              DateTime   @default(now()) @updatedAt
  user                   User       @relation(fields: [userId], references: [id], onDelete: Cascade)
  userId                 String
  images                 Image[]
  pdfs                   ClaimPdf[]
  ndas                   Nda[]
  bids                   Bid[]
}

model Image {
  id           String @id @default(uuid())
  supabase_url String
  claim        Claim  @relation(fields: [claimId], references: [id], onDelete: Cascade)
  claimId      String
}

model ClaimPdf {
  id           String @id @default(uuid())
  supabase_url String
  claim        Claim  @relation(fields: [claimId], references: [id], onDelete: Cascade)
  claimId      String
}

model Bid {
  id                    String   @id @default(uuid())
  amount                Float
  budgetTotal           Float
  bidPdfPath            String
  subContractorExpenses Float
  overhead              Float
  laborCosts            Float
  allowance             Float
  profit                Float
  user                  User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  userId                String
  claim                 Claim    @relation(fields: [claimId], references: [id], onDelete: Cascade)
  claimId               String
  createdAt             DateTime @default(now())
  updatedAt             DateTime @default(now()) @updatedAt
}

model Nda {
  id       String  @id @default(uuid())
  userId   String
  user     User    @relation(fields: [userId], references: [id], onDelete: Cascade)
  claimId  String
  claim    Claim   @relation(fields: [claimId], references: [id], onDelete: Cascade)
  accepted Boolean @default(false)
}
